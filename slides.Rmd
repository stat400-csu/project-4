---
title: "<span style='color:#1E4D2B;'>Monte Carlo Simulation of CIED Longevity</span>"
author: 'Group 4: Sydney, James, Waddah'
subtitle: '<span style=''color:#C8C372;''>STAT 400: Computational Statistics — Colorado
  State University</span>'
output:
  beamer_presentation: default
  ioslides_presentation:
    css: styles.css
  slidy_presentation: default
---

```{r setup, include=FALSE}
library(ggplot2)

# Demo dataset for plot
set.seed(1)
n_per_group <- 50000
results <- data.frame(
  long_years = c(
    rnorm(n_per_group, mean = 15.33, sd = 2.31),
    rnorm(n_per_group, mean = 15.26, sd = 2.37)
  ),
  scenario = factor(rep(c("Base (500 Ohms)", "Extended (500 Ohms ± 100 Ohms)"), each = n_per_group))
)
```

## Motivation 

* CIED (pacemaker) batteries require surgical replacement.

* Longevity prediction helps avoid too-early or too-late replacement.

* Lead impedance affects pacing current → may affect battery life.

* We use a Monte Carlo simulation to test whether impedance variability changes predicted longevity.


## Simulation Inputs 

* 100,000 simulated patients.

* Variables included: heart rate, pacing %, battery capacity, background current, impedance.

* Two impedance conditions:

  * **Base:** fixed at 500 Ohms

  * **Extended:** N(500 Ohms, SD = 100 Ohms)

* Purpose: isolate the effect of impedance variability.

## Problem Statement & Methodology 

* **Question:** Does impedance variability meaningfully change predicted longevity?
* **Steps:**
  1. Implement PCI model.
  2. Simulate patient and device parameters.
  3. Compute longevity under both impedance scenarios.
  4. Compare means and distributions.

## PCI Model: Concept Overview 

* PCI = electrical load relative to battery capacity.
* Lower impedance → more current → shorter longevity.
* Components:

  * Pacing current
  * Background/system current
  * Optional features current

## PCI Model: Pacing Current Formula 

```{r}
p_current <- function(v, pw_ms, r_ohm, hr = 60, 
                      pace_fraction = 0.3){
  # Convert Pulse width to seconds
  pw_sec  <- pw_ms / 1000
  
  # Current during pulse
  i_pulse <- v / r_ohm
  
  # Charge per pulse in Coulombs
  q       <- i_pulse * pw_sec
  
  # Convert to microcoulombs
  q_micro <- q * 1e6
  
  # Average current over 1 minute
  i_avg_microamps <- (q_micro * hr * pace_fraction)/60
  return(i_avg_microamps)
}
```

## PCI Model: Longevity Formula 

```{r}
long <- function(i_background, i_pacing, 
                 i_options, c_mah){
  # Convert battery capacity from mAh to µAh
  c_uah      <- c_mah * 1000
  # Total current in µA
  i_total    <- i_background + i_pacing + 
    i_options
  # Power Consumption Index (PCI)
  PCI        <- i_total / c_uah
  # Longevity in hours
  long_hours <- 1 / PCI
  # Longevity in years
  long_hours / 8760
  return(list(
    i_total = i_total,
    PCI = PCI,
    years = long_years))
  }
```

## Monte Carlo Framework (How We Tested) 


**For each of 100,000 patients:**

1. Calculate longevity with perfect 500 Ohms impedance

2. Calculate longevity with realistic variable impedance

3. Compare the two results


**This isolates** the effect of impedance variability by controlling for other patient differences


## Longevity Summary Table 

| Scenario             | Mean  | Median | SD   | Q1    | Q3    | n       |
| -------------------- | ----- | ------ | ---- | ----- | ----- | ------- |
| Base (500 Ohms)      | 15.33 | 15.12  | 2.31 | 13.68 | 16.76 | 100,000 |
| Extended (±100 Ohms) | 15.26 | 15.08  | 2.37 | 13.58 | 16.73 | 100,000 |


* Longevity slightly lower under impedance variability.
* Differences are small. 

## T-Test Results 

```
Welch Two Sample t-test

t = 6.61
p-value = 3.76e-11

95% CI: 0.049 to 0.090 years
Mean(Base)     = 15.33
Mean(Extended) = 15.26
```


## Longevity Distribution Plot

```{r, echo=FALSE, fig.height=3.5, fig.width=8}
ggplot(results, aes(x = long_years, fill = scenario)) +
  geom_density(alpha = 0.6) +
  scale_fill_manual(values = c("blue", "gold")) +
  labs(
    title = "CIED Longevity: Base vs Extended Impedance",
    x = "Longevity (years)",
    y = "Density",
    fill = "Scenario"
  ) +
  theme_minimal(base_size = 16) +
  theme(
    plot.title = element_text(color = "darkblue", face="bold"),
    axis.title = element_text(color = "black")
  )
```
  
  - Strong overlap → impedance variability has small effect.
  - Near-identical distributions → minimal practical difference.
  - Slight separation aligns with statistical findings.
  - Same distribution shape → consistent prediction patterns.



## Discussion 

* Background/system current has strongest influence on longevity.
* Impedance variability causes small, predictable changes.
* Pacing burden + background current dominate longevity outcomes.

## Limitations & Future Work 

* Impedance treated as static (real devices drift).
* Model excludes multi-lead systems and adaptive algorithms.
* Could expand with dynamic impedance or clinical validation.


## Conclusion 

* Impedance variability slightly reduces longevity.
* Predictions remain stable across realistic impedance ranges.
* Monte Carlo simulation provides strong framework for CIED evaluation.

## Thank You

**Questions?**

